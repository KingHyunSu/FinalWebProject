<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ClientBoard">

<resultMap type="com.postoffice.web.dto.MailDTO" id="Mail">
	<result column="mail_id" property="mail_id"/>
	<result column="from_name" property="from_name"/>
	<result column="from_address" property="from_address"/>
	<result column="to_name" property="to_name"/>
	<result column="to_address" property="to_address"/>
	<result column="mail_weight" property="mail_weight"/>
	<result column="package_Num" property="package_num"/>
	<result column="mail_date" property="mail_date"/>
<collection property="stateList" javaType="java.util.ArrayList" ofType="com.postoffice.web.dto.StateDTO">
	<result column="state_id" property="state_id"/>
	<result column="state_name" property="state_name"/>
</collection>
<collection property="villageList" javaType="java.util.ArrayList" ofType="com.postoffice.web.dto.VillageDTO">
	<result column="vname" property="vname"/>
</collection>
</resultMap>

	<select id="selectTotalRowNum" resultType="int">
		select count(*) from mail
	</select>
	<!-- 마을 이름 join해서 받아와야함 -->
	<select id="selectMailList" parameterType="map" resultMap="Mail">
	select rn,mail_id,from_name,from_address,to_name,to_address,mail_weight,state_name,mail_date,vname
		from(
		    select rownum as rn, mail_id,from_name,from_address,to_name,to_address,mail_weight,state_name,mail_date,vname
		    from(
		        select mail_id,from_name,from_address,to_name,to_address,mail_weight,state_name,mail_date,vname
		        from mail, village ,state
		        where mail.vid = village.vid and mail.state_id = state.state_id
		    )
		    where rownum &lt;= #{endRowNo}
		)
		where rn &gt; = #{startRowNo}
	</select>
	
	<select id="selectnum" resultType="int">
		select count(*) from Mail 
	</select>

<!-- 여기를 도저히 모르겠음 -->
	<insert id="insertBoard">
		insert into Mail(mail_id,from_name,from_address,to_name,to_address,mail_weight,state_name,mail_date,vname)
			select (#{from_name},#{from_address},#{to_name},#{to_address},#{mail_weight},'s001','v001')
			from mail,village,state
			where mail.vid = village.vid and mail_state_id = state.state_id
	</insert>
	 
	<delete id="removeRequest">
		delete Mail where mail_id = #{mail_id}
	</delete>
	
 	<select id="selectOne" parameterType="int" resultMap="Mail">
 	select 
			mail_id,from_name,from_address,to_name,to_address,mail_weight,state_name,mail_date,vname 
		from 
			mail ,village ,state
		
		where mail_id=#{mail_id} 
		and mail.vid=village.vid 
		and mail.state_id=state.state_id
	</select>

	<update id="updateOne" parameterType="com.postoffice.web.dto.MailDTO">
		update mail set mail_id=#{mail_id}
		,from_name=#{from_name}
		,from_address=#{from_address}
		,to_name=#{to_name}
		,to_address=#{to_address}
		,mail_weight=#{mail_weight}
		where mail_id = #{mail_id}
	</update>
	
	<!-- 이것도 -->
	<select id="selectsearch" parameterType="map" resultType="com.postoffice.web.dto.MailDTO">		
		select rn,mail_id,from_name,from_address,to_name,to_address,mail_weight,state_id,mail_id	
		from(
		    select rownum as rn, mail_id,from_name,from_address,to_name,to_address,mail_weight,state_id	,mail_date
		    from(
		        SELECT
					*
				FROM
					mail
				WHERE
					from_name
				LIKE
					#{keyword}
		    )
		    where rownum &lt;= #{endRowNo}
		)
		where rn &gt; = #{startRowNo}
	</select>
	
	<select id="toselectsearch" parameterType="map" resultType="com.postoffice.web.dto.MailDTO">		
		select rn,mail_id,from_name,from_address,to_name,to_address,mail_weight,state_id,mail_date	
		from(
		    select rownum as rn, mail_id,from_name,from_address,to_name,to_address,mail_weight,state_id,mail_date
		    from(
		        SELECT
					*
				FROM
					mail
				WHERE
					to_name
				LIKE
					#{keyword}
		    )
		    where rownum &lt;= #{endRowNo}
		)
		where rn &gt; = #{startRowNo}
	</select>
</mapper>