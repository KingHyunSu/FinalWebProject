<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="notice">

	
	<resultMap type="com.postoffice.web.dto.MemberDTO" id="notice2">
		<result column="mid" property="mid"/>
		<result column="mname" property="mname"/>
		<result column="mpassword" property="mpassword"/>
		 <collection property="noticeList" column="mid" javaType="java.util.ArrayList" ofType="com.postoffice.web.dto.NoticeDTO"></collection>
	</resultMap>
	
	<resultMap type="com.postoffice.web.dto.NoticeDTO" id="notice">
		<result column="mid" property="mid"/>
		<result column="notice_id" property="notice_id"/>
		<result column="notice_title" property="notice_title"/>
		<result column="notice_content" property="notice_content"/>
		<result column="notice_date" property="notice_date"/>
		<collection  property="memberList" javaType="java.util.ArrayList" ofType="com.postoffice.web.dto.MemberDTO">
			<result column="dept_id" property="dept_id"/>
			<result column="mname" property="mname"/>
		</collection >
		<collection property="deptList" javaType="java.util.ArrayList" ofType="com.postoffice.web.dto.DeptDTO">
			<result column="dept_name" property="dept_name"/>
		</collection>
	</resultMap>
	
	<select id="noticeList" parameterType="map" resultMap="notice" >
		select rn, notice_id, notice_title, notice_date, dept_id, mid, mname, dept_name
		from(
			select rownum as rn,  notice_id, notice_title, notice_date, dept_id, mid, mname,dept_name
			from
			(
				select n.notice_id, n.notice_title, n.notice_date, m.dept_id, n.mid, m.mname, d.dept_name
				from notice n, member m, dept d
				where n.mid = m.mid
				and m.dept_id = d.dept_id
				order by notice_id desc
			)
			where rownum &lt;=#{endRowNum}
		)
		where rn &gt;=#{startRowNum}
	</select>
	
	<select id="selectnotice" parameterType="int" resultType="com.postoffice.web.dto.NoticeDTO">
		select notice_id, notice_title, notice_content, notice_attach_file, notice_date, mid 
		from notice 
		where notice_id=#{notice_id}
	</select>
	
	<select id="selectTotalRowNum" resultType="int">
		select count(*) from notice
	</select>
	
	<insert id="noticeinsert" parameterType="com.postoffice.web.dto.NoticeDTO">
	<selectKey keyProperty="notice_id" resultType="int" order="BEFORE">
			select notice_num_seq.nextval from dual
		</selectKey>
		insert into notice(notice_id, notice_title, notice_content,notice_attach_file,notice_date,mid)
		values(#{notice_id},#{notice_title}, #{notice_content},#{notice_attach_file}, sysdate, #{mid})
	</insert>
	
	<!-- 테스트 코드 -->
	<select id="testMember" resultType="com.postoffice.web.dto.MemberDTO">
		SELECT
			*
		FROM
			member
	</select>
	
	<select id="testNotice" resultMap="notice">
		select n.notice_id, n.notice_title, n.notice_date, m.dept_id, n.mid, m.mname, d.dept_name
		from notice n, member m, dept d
		where n.mid = m.mid
		and m.dept_id = d.dept_id
		order by notice_id desc
	</select>
</mapper>